---
import { Icon } from 'astro-icon/components';

import PageLayout from '~/layouts/PageLayout.astro';
import { chapters, manualMeta } from '~/data/manual';
import { getPermalink } from '~/utils/permalinks';

import heroImage from '~/assets/images/akagera/photo_03_wide.jpg';
import stepsImage from '~/assets/images/akagera/Figure_2_Steps_of_formulating_CDS_of_ANP.png';
import objectivesImage from '~/assets/images/akagera/Figure_6_Objectives_of_each_component_of_the_ANP_CDS_2.png';
import akageraTeaser from '~/assets/images/akagera/photo_11_wide.jpg';

const metadata = {
  title: manualMeta.title,
  ignoreTitleTemplate: true,
  description: manualMeta.projectSummary,
};

const focusAreas = [
  {
    title: 'Engagement',
    description: 'Represent communities and local authorities in park planning and dialogue.',
    tone: 'bg-[#bf534f] text-white',
  },
  {
    title: 'Education',
    description: 'Build skills and conservation literacy through practical school and community work.',
    tone: 'bg-[#97b45a] text-white',
  },
  {
    title: 'Economy',
    description: 'Connect livelihoods with conservation value and reduce pressure on park resources.',
    tone: 'bg-[#7f67a8] text-white',
  },
];

const briefingCards = [
  {
    title: 'What it is for',
    text: manualMeta.briefing.whatItIs,
  },
  {
    title: 'Why it was developed',
    text: manualMeta.briefing.whyDeveloped,
  },
  {
    title: 'Who it helps',
    text: manualMeta.briefing.whoItHelps,
  },
];

const processSteps = [
  'On-job training and first diagnostics (November 2023)',
  'Internal analysis and first strategy drafts',
  'Consultation sessions with experts (November 2024)',
  'CDD finalization and strategy approvals',
  'Next step: in-depth socioeconomic and behaviour surveys',
];

const chapterBorderColors = ['#3f5644', '#62835d', '#8d7456', '#91789f', '#6d8f5f', '#546f79'];
---

<PageLayout metadata={metadata}>
  <section class="hero-section relative w-full overflow-hidden text-white">
    <img
      src={heroImage.src}
      alt="Giraffes in Akagera"
      class="hero-photo absolute inset-0 h-full w-full object-cover"
      loading="eager"
    />
    <div class="hero-overlay absolute inset-0"></div>

    <div
      class="relative mx-auto flex min-h-[86svh] max-w-7xl flex-col justify-center px-6 py-20 md:min-h-[88vh] md:py-24"
    >
      <p class="mb-3 text-xs font-semibold uppercase tracking-[0.22em] text-[#dfe8d8]">{manualMeta.version}</p>
      <h1 class="max-w-4xl font-heading text-5xl leading-[1.02] md:text-7xl">
        Conservation x Education Guidance Manual
      </h1>
      <p class="mt-6 max-w-3xl text-base leading-relaxed text-[#e8efe5] md:text-xl">
        A clear first version of the Akagera methodology to build conservation constituencies through the 3E+ framework:
        Engagement, Education, and Economy.
      </p>

      <div class="mt-9 flex flex-wrap gap-3">
        <a
          href={manualMeta.pdfPath}
          download
          class="btn-primary !bg-[#6e8e62] !border-[#6e8e62] hover:!bg-[#5e7b54] hover:!border-[#5e7b54]"
        >
          Download the guide
          <Icon name="tabler:download" class="ml-2 h-5 w-5" />
        </a>
        <button
          id="toolbox-button"
          type="button"
          class="btn-secondary !border-[#dce7d4]/70 !bg-white/5 !text-[#dce7d4] !opacity-75 cursor-not-allowed"
          aria-disabled="true"
          title="Toolbox download is not ready yet"
        >
          Download Toolbox
        </button>
        <a href="#project" class="btn-secondary !border-[#dce7d4] !text-white hover:!bg-white/15">Learn more</a>
      </div>
      <p id="toolbox-note" class="mt-3 hidden text-sm text-[#dce7d4]">
        Toolbox is in preparation and will be ready for download soon.
      </p>

      <div class="mt-10 grid max-w-4xl grid-cols-1 gap-3 text-sm md:grid-cols-3">
        <div class="rounded-2xl border border-white/20 bg-white/10 px-4 py-4 backdrop-blur">
          <p class="text-2xl font-semibold">42</p>
          <p class="text-[#dce7d4]">Pages in the manual</p>
        </div>
        <div class="rounded-2xl border border-white/20 bg-white/10 px-4 py-4 backdrop-blur">
          <p class="text-2xl font-semibold">6</p>
          <p class="text-[#dce7d4]">Core parts in the framework</p>
        </div>
        <div class="rounded-2xl border border-white/20 bg-white/10 px-4 py-4 backdrop-blur">
          <p class="text-2xl font-semibold">1</p>
          <p class="text-[#dce7d4]">Operational case study: Akagera</p>
        </div>
      </div>
    </div>
  </section>

  <section id="project" class="w-full bg-[#eff2e9]">
    <div class="mx-auto grid max-w-7xl gap-12 px-6 py-16 md:grid-cols-[1.1fr_0.9fr] md:items-center md:py-20">
      <div>
        <p class="text-xs font-semibold uppercase tracking-[0.2em] text-[#4f6957]">Project overview</p>
        <h2 class="mt-3 font-heading text-4xl leading-tight text-[#1f3226] md:text-5xl">What this guidance delivers</h2>
        <p class="mt-5 max-w-2xl text-base leading-relaxed text-[#304238] md:text-lg">{manualMeta.projectSummary}</p>
        <div class="mt-8 grid gap-3 sm:grid-cols-3">
          {
            focusAreas.map((area) => (
              <article class:list={['rounded-2xl px-5 py-6 shadow-sm', area.tone]}>
                <h3 class="text-xl font-semibold">{area.title}</h3>
                <p class="mt-2 text-sm leading-relaxed text-white/90">{area.description}</p>
              </article>
            ))
          }
        </div>
      </div>
      <div class="rounded-3xl border border-black/10 bg-white p-3 shadow-[0_20px_46px_rgba(32,54,40,0.16)]">
        <img
          src={objectivesImage.src}
          alt="Objectives of the 3E components"
          class="w-full rounded-2xl object-cover"
          loading="lazy"
        />
      </div>
    </div>
  </section>

  <section class="w-full border-y border-black/5 bg-[#f6f7f2]">
    <div class="mx-auto max-w-7xl px-6 py-16 md:py-20">
      <p class="text-xs font-semibold uppercase tracking-[0.2em] text-[#4f6957]">Manual briefing</p>
      <h2 class="mt-3 font-heading text-4xl leading-tight text-[#1f3226] md:text-5xl">Why this project was built</h2>
      <div class="mt-8 grid gap-4 md:grid-cols-3">
        {
          briefingCards.map((card) => (
            <article class="rounded-2xl border border-[#d3dcc9] bg-white px-5 py-5 shadow-[0_12px_24px_rgba(30,49,37,0.07)]">
              <h3 class="text-lg font-semibold text-[#24372c]">{card.title}</h3>
              <p class="mt-3 text-sm leading-relaxed text-[#3b4f43]">{card.text}</p>
            </article>
          ))
        }
      </div>
    </div>
  </section>

  <section class="w-full bg-[#f6f7f2]">
    <div class="mx-auto grid max-w-7xl gap-12 px-6 py-16 md:grid-cols-[0.95fr_1.05fr] md:items-start md:py-20">
      <div class="rounded-3xl border border-black/10 bg-white p-3 shadow-[0_20px_44px_rgba(38,53,42,0.14)]">
        <img
          src={stepsImage.src}
          alt="Steps of strategy formulation"
          class="w-full rounded-2xl object-cover"
          loading="lazy"
        />
      </div>
      <div>
        <p class="text-xs font-semibold uppercase tracking-[0.2em] text-[#4f6957]">How it was developed</p>
        <h2 class="mt-3 font-heading text-4xl leading-tight text-[#1f3226] md:text-5xl">Akagera process in brief</h2>
        <ul class="mt-8 space-y-3">
          {
            processSteps.map((step) => (
              <li class="flex gap-3 rounded-2xl border border-[#d7dfcf] bg-white px-4 py-4 text-[#2e4135]">
                <span class="mt-1 h-2.5 w-2.5 shrink-0 rounded-full bg-[#6b8b61]" />
                <span>{step}</span>
              </li>
            ))
          }
        </ul>
      </div>
    </div>
  </section>

  <section id="chapters" class="w-full bg-[#eef1e8]">
    <div class="mx-auto max-w-7xl px-6 py-16 md:py-20">
      <p class="text-xs font-semibold uppercase tracking-[0.2em] text-[#4f6957]">Guide structure</p>
      <h2 class="mt-3 font-heading text-4xl leading-tight text-[#1f3226] md:text-5xl">Chapters with dedicated pages</h2>
      <p class="mt-4 max-w-3xl text-[#33453a]">
        All chapter parts are combined on one heavy chapters page with direct section anchors.
      </p>

      <div class="mt-10 grid gap-4 md:grid-cols-2 xl:grid-cols-3">
        {
          chapters.map((chapter, index) => (
            <article
              class="rounded-2xl border-2 bg-white p-5 shadow-[0_12px_28px_rgba(30,49,37,0.08)] transition hover:-translate-y-0.5"
              style={`border-color: ${chapterBorderColors[index]};`}
            >
              <p class="text-xs font-semibold uppercase tracking-[0.16em] text-[#5e7463]">{chapter.label}</p>
              <h3 class="mt-2 text-xl font-semibold text-[#23362b]">{chapter.title}</h3>
              <p class="mt-3 text-sm leading-relaxed text-[#405447]">{chapter.summary}</p>
              <a
                href={`${getPermalink('/chapters')}#${chapter.slug}`}
                class="mt-4 inline-flex items-center text-sm font-semibold text-[#365540] hover:text-[#243d2e]"
              >
                Open chapter section
                <Icon name="tabler:arrow-up-right" class="ml-1 h-4 w-4" />
              </a>
            </article>
          ))
        }
      </div>
    </div>
  </section>

  <section class="w-full border-y border-black/5 bg-[#edf1e6]">
    <div class="mx-auto grid max-w-7xl gap-8 px-6 py-16 md:grid-cols-[1.15fr_0.85fr] md:items-center md:py-20">
      <div>
        <p class="text-xs font-semibold uppercase tracking-[0.2em] text-[#4f6957]">Akagera case study</p>
        <h2 class="mt-3 font-heading text-4xl leading-tight text-[#1f3226] md:text-5xl">
          Map and field evidence moved to a separate page
        </h2>
        <p class="mt-5 max-w-3xl text-base leading-relaxed text-[#33473c]">
          Explore the full Akagera case page with map, process figures, and image references from field implementation.
        </p>
        <a
          href={getPermalink('/akagera-case-study')}
          class="mt-7 inline-flex items-center rounded-full border border-[#5f7f58] px-5 py-3 text-sm font-semibold text-[#2e4435] transition hover:bg-[#dae4d1]"
        >
          Open Akagera Case Study
          <Icon name="tabler:arrow-up-right" class="ml-2 h-4 w-4" />
        </a>
      </div>
      <div class="rounded-3xl border border-black/10 bg-white p-3 shadow-[0_18px_38px_rgba(31,47,36,0.13)]">
        <img
          src={akageraTeaser.src}
          alt="Akagera wildlife context"
          class="w-full rounded-2xl object-cover"
          loading="lazy"
        />
      </div>
    </div>
  </section>

  <section class="w-full bg-[#2d4334] text-white">
    <div
      class="mx-auto flex max-w-7xl flex-col items-start gap-6 px-6 py-16 md:flex-row md:items-center md:justify-between md:py-20"
    >
      <div>
        <p class="text-xs font-semibold uppercase tracking-[0.2em] text-[#c9d7c0]">Ready to use</p>
        <h2 class="mt-3 font-heading text-4xl leading-tight md:text-5xl">Download the full guidance manual</h2>
        <p class="mt-4 max-w-2xl text-[#dbe5d5]">Primary document for implementation teams and partners.</p>
      </div>
      <div class="flex flex-wrap gap-3">
        <a
          href={manualMeta.pdfPath}
          download
          class="btn-primary !bg-[#89a86d] !border-[#89a86d] hover:!bg-[#78985d] hover:!border-[#78985d]"
        >
          Download PDF
          <Icon name="tabler:download" class="ml-2 h-5 w-5" />
        </a>
        <a href="#project" class="btn-secondary !border-white/50 !text-white hover:!bg-white/15">Back to overview</a>
      </div>
    </div>
  </section>
</PageLayout>

<style is:global>
  html {
    scroll-behavior: smooth;
  }

  .hero-section {
    background-color: #223629;
  }

  .hero-photo {
    filter: saturate(88%) contrast(93%);
  }

  .hero-overlay {
    background:
      linear-gradient(102deg, rgba(24, 43, 31, 0.9) 14%, rgba(40, 63, 48, 0.76) 52%, rgba(26, 44, 34, 0.84) 100%),
      linear-gradient(180deg, rgba(24, 41, 30, 0.1) 0%, rgba(24, 41, 30, 0.64) 100%);
  }

  @media (max-width: 767px) {
    .hero-photo {
      object-position: 68% center;
    }
  }
</style>

<script>
  const toolboxButton = document.getElementById('toolbox-button');
  const toolboxNote = document.getElementById('toolbox-note');

  if (toolboxButton && toolboxNote) {
    toolboxButton.addEventListener('click', () => {
      toolboxNote.classList.remove('hidden');
    });
  }
</script>
